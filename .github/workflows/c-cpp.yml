name: C/C++ CI

on:
  pull_request:
    types: [ opened, edited, synchronize, reopened ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    
    - name: TICS Action Setup
      uses: actions/checkout@v2
      with:
        repository: tiobetestlab/.github
        path: ./.github
    
    - name: make all
      run: make all
    
    - name: TICS Action Run
      uses: ./.github/actions/tics
      env: 
        GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        TICS: https://testlab.tiobe.com/tiobeweb/testlab/api/cfg?name=testlab
      with:
        projectName: 'c-demo'
        branchName: 'main'
        ticsViewerUrl: 'https://testlab.tiobe.com/tiobeweb/testlab/'
        ticsAuthToken: 'NGUyOTFkMzMtM2ExYS00MDhjLTgzMDktMTVlNjBlYjZmMzM5OnBTWiVNUl5FZmdSLTpwQg'
        clientToken: 'c-demo'
        tmpDir: '\tmp\c-demo'
        calc: 'BEGIN,CW,CS,FANOUT,CY,DUP,END'

